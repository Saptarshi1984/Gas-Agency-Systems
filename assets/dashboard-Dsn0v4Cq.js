import{g as R,o as T,k as H,i as b,h as S,q as U,w as Y,d as r,c as u,l as q,u as $,j as M}from"./firebase-DJ51gAwz.js";const i=R(),I=document.getElementById("dashboardSec"),h=document.getElementById("profileSec"),L=document.getElementById("bookingSec"),k=document.getElementById("requestSec"),v=document.getElementById("dashboardTab"),f=document.getElementById("profileTab"),E=document.getElementById("bookingsTab"),B=document.getElementById("requestTab"),F=document.getElementById("refillOrder"),A=document.getElementById("refillBtn"),y=document.getElementById("modifyBtn"),j=document.getElementById("saveBtn"),z=document.getElementById("logout");let s=null;(function(){emailjs.init({publicKey:"UhBBBYsV5Pm9nqJgp"})})();T(M,async e=>{if(e){s=e;const t=r(i,"users",e.uid),n=await u(t);if(n.exists()){const a=n.data();document.getElementById("pName").textContent=`Hello, ${a.name}`}else console.log("No user data found in Firestore.")}else window.location.href="/index.html"});z.addEventListener("click",()=>{H(M).then(()=>{window.location.href="/index.html"}).catch(e=>{alert("An error occured:"+e.Message)})});v.addEventListener("click",e=>{e.preventDefault(),v.classList.toggle("active"),I.style.display="flex",h.style.display="none",L.style.display="none",k.style.display="none",f.classList.remove("active"),E.classList.remove("active"),B.classList.remove("active"),document.getElementById("refill").style.display="none"});f.addEventListener("click",async e=>{if(e.preventDefault(),f.classList.toggle("active"),v.classList.remove("active"),E.classList.remove("active"),h.style.display="flex",I.style.display="none",L.style.display="none",k.style.display="none",B.classList.remove("active"),s){const t=r(i,"users",s.uid),n=await u(t);if(n.exists()){const a=n.data();document.getElementById("inputName").value=a.name||"",document.getElementById("inputEmail").value=a.email||"",document.getElementById("inputAadhar").value=a.aadhar||"",document.getElementById("inputMobile").value=a.mobile||"",document.getElementById("inputAddress").value=a.address||""}}});E.addEventListener("click",async e=>{e.preventDefault(),f.classList.remove("active"),v.classList.remove("active"),E.classList.toggle("active"),h.style.display="none",I.style.display="none",k.style.display="none",L.style.display="flex",B.classList.remove("active");const t=document.getElementById("bookingLists");t.innerHTML="";const n=b(i,"orders",s.uid,"userOrders");(await S(n)).forEach(c=>{const d=c.data(),o=document.createElement("tr");o.innerHTML=`<td>${d.dateOfOrder}</td>
                       <td>${d.idOfOrder}</td>
                       <td>${d.Amount}.00</td>
                       <td>${d.status||"Pending"}</td>
                       <td><button  class ='btnPrimary payNow' type="button">Pay Now</button></td>`,t.appendChild(o)})});B.addEventListener("click",async e=>{e.preventDefault(),B.classList.toggle("active"),k.style.display="flex",h.style.display="none",L.style.display="none",I.style.display="none",f.classList.remove("active"),E.classList.remove("active"),v.classList.remove("active");const t=document.getElementById("userRequestsHistory");t.innerHTML="";let n=1;const a=b(i,"db_CylinderReq"),c=U(a,Y("uid","==",s.uid));(await S(c)).forEach(o=>{const l=o.data(),m=document.createElement("tr");m.innerHTML=`<td>${n++}</td>
                       <td>${l.date}</td>
                       <td>${o.id}</td>                       
                       <td>${l.status===""?"Pending":l.status}</td>`,t.appendChild(m)})});document.getElementById("addCylCheckBox").addEventListener("change",async function(){this.checked?document.getElementById("addCylinder").classList.remove("inActive"):(document.getElementById("addCylinder").classList.add("inActive"),document.getElementById("addCylinder").classList.remove("active"),document.getElementById("addCylinder").disabled="true")});document.getElementById("addCylinder").addEventListener("click",async()=>{try{["declaration","checkBox","addCylinder"].forEach(w=>{document.getElementById(w).style.display="none"});const e=new Date,t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear(),c=`${t}/${n}/${a}`,d=r(i,"users",s.uid),o=await u(d),l=o.exists()?o.data():{},m=r(i,"Bookings",s.uid),D=(await u(m)).data(),g=b(i,"db_CylinderReq");D.CylCount===0?await q(g,{name:l.name||"Unnamed User",uid:s.uid,date:c,status:""}):alert("Cylinders are available in your account");const p=document.getElementById("confirmMsg");p.style.cssText="display:block; width:50%; font-size:1.6rem;",p.textContent="Your request is received and under review. An email will be sent to your registered email ID for further communication."}catch(e){const t=e.message||"Unknown error";alert("Error in processing additional cylinder: "+t)}});document.getElementById("modifyBtn").addEventListener("click",()=>{["inputName","inputEmail","inputAadhar","inputMobile","inputAddress","saveBtn"].forEach(e=>{document.getElementById(e).disabled=!1}),y.disabled=!0,y.classList.add("inActive"),y.classList.remove("btnPrimary"),document.getElementById("saveBtn").classList.add("btnPrimary")});j.addEventListener("click",async e=>{e.preventDefault(),s||(alert("User not Logged in"),window.location.href="/index.html");const t=r(i,"users",s.uid),n={name:document.getElementById("inputName").value.trim(),email:document.getElementById("inputEmail").value.trim(),aadhar:document.getElementById("inputAadhar").value.trim(),mobile:document.getElementById("inputMobile").value.trim(),address:document.getElementById("inputAddress").value.trim()};try{await $(t,n),["inputName","inputEmail","inputAadhar","inputMobile","inputAddress","saveBtn"].forEach(a=>{document.getElementById(a).disabled=!0}),document.getElementById("saveBtn").classList.remove("btnPrimary"),alert("Profile updated successfully!")}catch(a){console.error("Error updating profile:",a),alert("Failed to update profile.")}y.disabled=!1,y.classList.add("btnPrimary"),y.classList.remove("inActive")});document.getElementById("request").addEventListener("click",async e=>{if(e.preventDefault(),document.getElementById("refill").style.display="flex",s){const t=r(i,"users",s.uid),n=r(i,"Bookings",s.uid),a=await u(t),c=await u(n);if(document.getElementById("regNum").value=s.uid,a.exists()){const d=a.data(),o=c.data();if(document.getElementById("mName").value=d.name||"",document.getElementById("mNum").value=d.mobile||"",document.getElementById("mAdd").value=d.address||"",document.getElementById("cylCount").value=o.CylCount||"0",Number(o.CylCount)===0){A.innerHTML="";const l=document.createElement("div");l.innerHTML="<h2>You have ran-out of your alloted cylinders.</h2><h3>Go to Requests tab and Request Extra Cylinders</h3>",l.style.cssText="display:flex; flex-direction:column; gap: 0.8rem;text-align:center; letter-spacing:1px;",A.appendChild(l)}}["regNum","mName","mNum","mAdd","cylCount"].forEach(d=>{document.getElementById(d).disabled="true"})}});F.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("regNum").value,n=document.getElementById("mName").value,a=document.getElementById("mNum").value,c=document.getElementById("mAdd").value,d=document.getElementById("cylCount").value;if(!t||!n||!a||!c||!d){alert("Please Complete Your Profile in your Profile section!");return}const o=new Date,l=o.getDate(),m=o.getMonth()+1,C=o.getFullYear(),D=`${l}/${m}/${C}`,g=`${l}${m}${C}${s.uid.slice(0,4).toUpperCase()}${Math.floor(Math.random()*1e3)}`,p=990,w=b(i,"orders",s.uid,"userOrders"),x=r(i,"Bookings",s.uid);q(w,{dateOfOrder:D,idOfOrder:g,Amount:p});const N=await u(x);if(N.exists()){const _=N.data().CylCount-1;await $(x,{CylCount:_})}const O=s.email;var P={name:n,email:O,price:p,order_id:g};emailjs.send("service_texmdlm","template_roi2uta",P),alert(`'Order Placed Succesfully Order Id: ${g}, Email sent, check SPAM folder' `),document.getElementById("refill").style.display="none"});document.getElementById("BtnCancel").addEventListener("click",()=>{document.getElementById("refill").style.display="none"});const G=document.getElementById("mobileHome");G.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("mobileNavBox"),n=document.getElementById("icon");t.style.display==="flex"?(t.style.display="none",n.classList.remove("fa-xmark"),n.classList.add("fa-bars")):(t.style.display="flex",n.classList.add("fa-xmark"),n.classList.remove("fa-bars"))});
