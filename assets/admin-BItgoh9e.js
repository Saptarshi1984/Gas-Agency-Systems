import{h as i,i as b,m as a,u as f,d as E,q,n as I}from"./firebase-DJ51gAwz.js";const u=document.getElementById("adminDashboardTab"),y=document.getElementById("actionsTab"),p=document.getElementById("requestTab"),L=document.getElementById("adminDashboardSec"),w=document.getElementById("adminActionsSec"),S=document.getElementById("adminRequestSec");window.onload=async()=>{const s=sessionStorage.getItem("AdminEmail");if(!s)alert.error("Admin does not exists, Login Error"),window.location.href="/index.html";else{const d=(await i(b(a,"admin"))).docs.map(n=>n.data()).find(n=>n.email===s);d&&(document.getElementById("adminName").textContent=`Hello, ${d.name}`)}const o=document.getElementById("numSubscriber"),l=async()=>{try{const e=b(a,"users"),t=await i(e);o.textContent=t.size}catch(e){alert("Error fetching user count:",e),o.textContent="Error"}},h=document.getElementById("totalOrders"),x=async()=>{const e=q(I(a,"userOrders")),t=await i(e);h.textContent=t.size},c=document.getElementById("totalRevenue"),v=async()=>{let e=0;const t=q(I(a,"userOrders"));(await i(t)).forEach(n=>{const r=n.data();r.Amount&&(e+=Number(r.Amount))}),c.textContent=e};l(),x(),v()};u.addEventListener("click",s=>{s.preventDefault(),u.classList.add("active"),y.classList.remove("active"),p.classList.remove("active"),L.style.display="flex",w.style.display="none",S.style.display="none"});y.addEventListener("click",s=>{s.preventDefault(),u.classList.remove("active"),y.classList.add("active"),p.classList.remove("active"),L.style.display="none",w.style.display="flex",S.style.display="none"});p.addEventListener("click",async s=>{s.preventDefault();const o=document.getElementById("requestsBody");o.innerHTML="";let l=0;u.classList.remove("active"),y.classList.remove("active"),p.classList.add("active"),L.style.display="none",w.style.display="none",S.style.display="flex";const h=b(a,"db_CylinderReq");(await i(h)).forEach((c,v)=>{l+=1;let e=v+1;const t=c.data(),d=document.createElement("tr");d.innerHTML=`<td>${l}</td>
                     <td>${t.date}</td>
                     <td>${c.id}</td>
                     <td>${t.name}</td>
                     <td>${t.uid}</td>
                     <td>${t.status==""?"Pending":t.status}</td>
                     <td id="btnChoices-${e}" class="btnChoice">
                     <i id="approve-${e}" class="approve fa-solid fa-circle-check"></i>
                     <i id="decline-${e}" class="decline fa-solid fa-circle-xmark"></i>
                     </td>`,o.appendChild(d),o.addEventListener("click",async n=>{const r=n.target.closest("tr"),C=r.children[2].textContent.trim(),m=r.querySelector(".btnChoice");if(n.target.classList.contains("approve"))try{await f(E(a,"db_CylinderReq",C),{status:"Approved"}),f(E(a,"Bookings",c.id),{cylCount:1}),m.innerHTML="Approved",m.style.cssText="background: white; color: green; font-weight:600"}catch(g){console.error("Failed to update status:",g)}if(n.target.classList.contains("decline"))try{await f(E(a,"db_CylinderReq",C),{status:"Declined"}),m.innerHTML="Declined",m.style.cssText="background: white; color: red; font-weight:600"}catch(g){console.error("Failed to update status:",g)}})})});document.getElementById("adminLogout").addEventListener("click",()=>{try{sessionStorage.removeItem("AdminEmail"),window.location.href="/index.html"}catch(s){alert("An error occurred: "+s.message)}});
